<div class="families-list-container">
  <header class="page-header">
    <h1>Vue administrative des familles</h1>
    <p class="page-subtitle">Supervision des dossiers familiaux</p>
  </header>

  @if (isLoading()) {
  <div class="loading-state">
    <p>Chargement des familles...</p>
  </div>
  } @if (error()) {
  <div class="error-state">
    <p>{{ error() }}</p>
  </div>
  } @if (!isLoading() && !error()) {
  <div class="families-table-wrapper">
    @if (familiesWithStatus().length === 0) {
    <div class="empty-state">
      <p>Aucune famille enregistrée</p>
    </div>
    } @else {
    <table class="families-table">
      <thead>
        <tr>
          <th>Parent 1</th>
          <th>Parent 2</th>
          <th>Contact principal</th>
          <th>Adresse</th>
          <th>Enfants</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        @for (item of familiesWithStatus(); track item.family.id) {
        <tr class="family-row" (click)="navigateToFirstChild(item.family)">
          <td class="parent-cell">{{ getParent1(item.family) }}</td>
          <td class="parent-cell">
            @if (getParent2(item.family)) { {{ getParent2(item.family) }} } @else {
            <span class="empty-value">—</span>
            }
          </td>
          <td class="contact-cell">{{ getMainContact(item.family) }}</td>
          <td class="address-cell">{{ getAddressSummary(item.family) }}</td>
          <td class="children-cell">
            @if (item.family.children && item.family.children.length > 0) {
            <div class="children-list">
              @for (child of item.family.children; track child.id; let isLast = $last) {
              <span
                class="child-link"
                tabindex="0"
                role="button"
                (click)="navigateToChild(child.id, $event)"
                (keydown.enter)="navigateToChild(child.id, $event)"
                (keydown.space)="navigateToChild(child.id, $event)"
                >{{ child.firstName }} {{ child.lastName }}</span
              >@if (!isLast) {<span class="separator">, </span>} }
            </div>
            } @else {
            <span class="empty-value">Aucun enfant</span>
            }
          </td>
          <td class="status-cell">
            <span
              class="status-badge"
              [class.status-ok]="item.status.status === 'ok'"
              [class.status-incomplet]="item.status.status === 'incomplet'"
            >
              {{ item.status.label }}
            </span>
          </td>
        </tr>
        }
      </tbody>
    </table>
    }
  </div>
  }
</div>
